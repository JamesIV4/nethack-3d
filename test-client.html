<!DOCTYPE html>
<html>
<head>
    <title>NetHack 3D Test Client</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        .log { border: 1px solid #333; height: 400px; overflow-y: scroll; padding: 10px; margin: 10px 0; }
        .status { color: #ff0; font-weight: bold; }
    </style>
</head>
<body>
    <h1>NetHack 3D Test Client</h1>
    <div class="status" id="status">Connecting...</div>
    <div class="log" id="log"></div>
    <button onclick="sendKey('q')">Send 'q' (quit)</button>
    <button onclick="sendKey('n')">Send 'n' (no)</button>
    <button onclick="sendKey('y')">Send 'y' (yes)</button>
    
    <script>
        const log = document.getElementById('log');
        const status = document.getElementById('status');
        let ws;
        
        function addLog(msg) {
            log.innerHTML += new Date().toLocaleTimeString() + ': ' + msg + '<br>';
            log.scrollTop = log.scrollHeight;
        }
        
        function connect() {
            addLog('Attempting to connect to NetHack server...');
            ws = new WebSocket('ws://localhost:3002');
            
            ws.onopen = () => {
                status.textContent = 'Connected to NetHack Server';
                addLog('‚úÖ Connected to NetHack server!');
            };
            
            ws.onmessage = (event) => {
                try {
                    const data = JSON.parse(event.data);
                    addLog(`üì® Received: ${data.type} - ${JSON.stringify(data)}`);
                } catch (e) {
                    addLog(`üì® Raw message: ${event.data}`);
                }
            };
            
            ws.onclose = () => {
                status.textContent = 'Disconnected';
                addLog('‚ùå Connection closed');
                setTimeout(connect, 3000);
            };
            
            ws.onerror = (error) => {
                addLog(`üö® WebSocket error: ${error}`);
            };
        }
        
        function sendKey(key) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ type: 'input', input: key }));
                addLog(`‚å®Ô∏è Sent key: ${key}`);
            } else {
                addLog('‚ùå Not connected to server');
            }
        }
        
        connect();
    </script>
</body>
</html>
